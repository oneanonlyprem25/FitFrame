<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FitFrame Pro — Studio</title>

<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1'/%3E%3Cpath d='M19 9h1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-9a2 2 0 0 1-2-2v-1'/%3E%3Cpath d='M10 9h4a1 1 0 0 1 1 1v4'/%3E%3C/svg%3E" type="image/svg+xml">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@700&family=Playfair+Display:wght@700;900&family=Oswald:wght@600&family=Righteous&display=swap" rel="stylesheet">

<style>
  /* ===== PROFESSIONAL DARK THEME CSS ===== */
  :root {
    /* --- BRAND FONT SELECTION --- */
    --font-brand: 'Space Grotesk', sans-serif; 

    --bg-body: #0f1014;
    --bg-panel: #18181b;
    --bg-input: #27272a;
    --border: #3f3f46;
    --text-main: #f4f4f5;
    --text-muted: #a1a1aa;
    --primary: #6366f1;
    --primary-hover: #4f46e5;
    --accent-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
    --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
  }

  * { box-sizing: border-box; outline: none; }
  
  body {
    margin: 0;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    height: 100vh; 
    display: flex;
    flex-direction: column;
    overflow: hidden; 
  }

  /* --- Header --- */
  .topbar {
    height: 60px;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    background: var(--bg-panel);
    flex-shrink: 0;
  }

  .brand {
    font-family: var(--font-brand);
    font-weight: 700;
    font-size: 24px;
    color: #fff;
    letter-spacing: -0.02em;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  /* 2. CUSTOM LOGO SVG CLASS */
  .logo-icon {
    width: 28px;
    height: 28px;
    stroke: #818cf8; /* Indigo Light */
  }
  
  .brand-text {
    background: var(--accent-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .brand span.badge { 
    font-family: 'Inter', sans-serif; 
    font-size: 11px; 
    background: #27272a; 
    color: #fff; 
    padding: 3px 8px; 
    border-radius: 6px; 
    -webkit-text-fill-color: initial; 
    font-weight: 600; 
    border: 1px solid var(--border);
    letter-spacing: 0.5px;
    transform: translateY(-1px);
  }

  /* --- Main Layout --- */
  .workspace {
    display: flex;
    flex: 1;
    height: calc(100vh - 60px);
    overflow: hidden;
  }

  .stage {
    flex: 1;
    background-color: #09090b;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    padding: 20px;
  }

  .canvas-container {
    box-shadow: var(--shadow);
    border-radius: 8px;
    overflow: hidden;
    background-image: 
      linear-gradient(45deg, #1c1c1c 25%, transparent 25%), 
      linear-gradient(-45deg, #1c1c1c 25%, transparent 25%), 
      linear-gradient(45deg, transparent 75%, #1c1c1c 75%), 
      linear-gradient(-45deg, transparent 75%, #1c1c1c 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    background-color: #121212; 
    transition: transform 0.2s ease;
    border: 1px solid #333;
  }
  
  canvas { display: block; max-width: 100%; height: auto; cursor: grab; }
  canvas:active { cursor: grabbing; }

  .stage-toolbar {
    position: absolute;
    bottom: 30px;
    background: rgba(24, 24, 27, 0.8);
    backdrop-filter: blur(12px);
    padding: 10px 16px;
    border-radius: 50px;
    border: 1px solid var(--border);
    display: flex;
    gap: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    z-index: 10;
    animation: floatUp 0.4s ease-out;
  }

  @keyframes floatUp { from { transform: translateY(20px); opacity: 0;} to { transform: translateY(0); opacity: 1;}}

  .sidebar {
    width: 340px;
    background: var(--bg-panel);
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    height: 100%;
  }

  .sidebar-content {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .sidebar-footer {
    flex-shrink: 0;
    padding: 20px 24px;
    background: var(--bg-panel);
    border-top: 1px solid var(--border);
    z-index: 20;
  }

  h3 { font-size: 12px; text-transform: uppercase; color: var(--text-muted); letter-spacing: 0.8px; margin: 0 0 12px 0; font-weight: 700; }
  .control-group { display: flex; flex-direction: column; gap: 14px; }
  label { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; display: block; }
  .row { display: flex; gap: 10px; }
  
  input[type="text"], input[type="number"], select {
    width: 100%;
    background: var(--bg-input);
    border: 1px solid var(--border);
    color: white;
    padding: 10px 12px;
    border-radius: 8px;
    font-size: 13px;
    transition: 0.2s;
  }
  input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15); }

  input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 8px 0; }
  input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #3f3f46; border-radius: 2px; }
  input[type=range]::-webkit-slider-thumb { height: 16px; width: 16px; border-radius: 50%; background: #fff; cursor: pointer; -webkit-appearance: none; margin-top: -6px; box-shadow: 0 2px 4px rgba(0,0,0,0.5); transition: transform 0.1s; }
  input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

  .btn { border: none; padding: 10px 16px; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; }
  .btn-icon { background: transparent; color: var(--text-main); padding: 8px; border-radius: 6px; }
  .btn-icon:hover { background: rgba(255,255,255,0.1); }
  
  .btn-primary { background: var(--primary); color: white; width: 100%; padding: 14px; font-weight: 600; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
  .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }

  .checkbox-wrapper { display: flex; align-items: center; justify-content: space-between; font-size: 13px; cursor: pointer; }
  .checkbox-wrapper input { margin-right: 8px; accent-color: var(--primary); }

  .upload-box {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 30px 20px;
    text-align: center;
    background: rgba(255,255,255,0.02);
    cursor: pointer;
    transition: 0.2s;
    margin-bottom: 20px;
  }
  .upload-box:hover { border-color: var(--primary); background: rgba(99, 102, 241, 0.05); }
  .upload-icon-svg { width: 64px; height: 64px; stroke: var(--text-muted); margin-bottom: 12px; opacity: 0.5; }
  .upload-text { font-weight: 600; color: var(--text-main); display: block; }
  .upload-hint { font-size: 11px; color: var(--text-muted); display: block; margin-top: 4px; }

  .stats {
    background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2);
    padding: 12px; border-radius: 8px; font-size: 12px; color: #c7d2fe; display: flex; justify-content: space-between;
    margin-bottom: 12px;
  }
  .hidden { display: none !important; }

  @media (max-width: 900px) {
    body { height: auto; overflow-y: auto; }
    .workspace { flex-direction: column; height: auto; }
    .sidebar { width: 100%; border-left: none; border-top: 1px solid var(--border); height: auto; }
    .sidebar-content { overflow: visible; }
    .stage { min-height: 50vh; }
  }
</style>
</head>
<body>

  <header class="topbar">
    <div class="brand">
      <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        <path d="M19 9h1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-9a2 2 0 0 1-2-2v-1"/>
        <path d="M10 9h4a1 1 0 0 1 1 1v4"/>
      </svg>
      <div class="brand-text">FitFrame</div> 
      <span class="badge">PRO</span>
    </div>
    <div style="display:flex; gap:10px; align-items:center">
       <a href="#" style="color:var(--text-muted); text-decoration:none; font-size:12px;">v2.3 Studio</a>
    </div>
  </header>

  <div class="workspace">
    <main class="stage">
      <div id="welcomeState" class="upload-box" style="max-width: 400px; width: 100%;">
        <label id="dropzone" style="cursor: pointer; width: 100%; display: block;">
            <input id="file" type="file" accept="image/*" class="hidden" />
            <svg class="upload-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
            <span class="upload-text">Click or Drop Image</span>
            <span class="upload-hint">Supports JPG, PNG, WebP, SVG (Import) • Ctrl+V to Paste</span>
        </label>
      </div>

      <div id="editorState" class="hidden" style="display: flex; flex-direction: column; align-items: center; width: 100%;">
        <div class="canvas-container">
          <canvas id="canvas"></canvas>
        </div>

        <div class="stage-toolbar">
          <button id="resetBtn" class="btn btn-icon" title="Reset View">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /></svg>
          </button>
          <button id="fitBtn" class="btn btn-icon" title="Fit to Box">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
          </button>
          <div style="width: 1px; background: var(--border); height: 24px;"></div>
          <div style="display: flex; align-items: center; gap: 8px; padding: 0 8px;">
            <span style="font-size:11px; color:var(--text-muted)">OVERLAY</span>
            <input id="overlayRange" type="range" min="0" max="0.9" step="0.05" value="0" style="width: 80px;" />
          </div>
        </div>
      </div>
    </main>

    <aside class="sidebar">
      <div class="sidebar-content">
        <div class="control-group">
          <h3>Layout & Size</h3>
          <label>Canvas Preset</label>
          <select id="preset">
            <option value="1000x1000">Square (1000 × 1000)</option>
            <option value="1200x628">Social Post (1200 × 628)</option>
            <option value="1080x1350">Portrait (1080 × 1350)</option>
            <option value="800x800">Icon (800 × 800)</option>
            <option value="custom">Custom Dimensions...</option>
          </select>

          <div id="customSize" class="row hidden">
            <div><label>Width</label><input id="outW" type="number" min="1" value="1000"></div>
            <div><label>Height</label><input id="outH" type="number" min="1" value="1000"></div>
          </div>

          <label style="margin-top:8px">Background Color</label>
          <select id="bgSelect">
            <option value="transparent">Transparent (PNG/WebP/SVG)</option>
            <option value="#ffffff">White</option>
            <option value="#000000">Black</option>
          </select>
        </div>

        <div style="height:1px; background:var(--border); margin: 4px 0;"></div>

        <div class="control-group">
          <h3>Export Settings</h3>
          <div class="row">
            <div style="flex:1">
              <label>Format</label>
              <select id="format">
                <option value="image/png">PNG</option>
                <option value="image/jpeg">JPEG</option>
                <option value="image/webp">WebP</option>
                <option value="image/svg+xml">SVG (Wrapper)</option>
              </select>
            </div>
            <div style="flex:1">
              <label>Filename</label>
              <input id="fname" type="text" value="cropped-image" />
            </div>
          </div>

          <div id="qualityWrap" class="hidden">
            <div class="checkbox-wrapper" style="margin-bottom:4px">
              <label style="margin:0">Quality</label>
              <span id="qval" style="color:var(--primary)">0.90</span>
            </div>
            <input id="quality" type="range" min="0.1" max="1" step="0.01" value="0.9">
          </div>

          <div style="background: var(--bg-input); padding: 12px; border-radius: 8px; display:flex; flex-direction:column; gap:8px;">
            <label class="checkbox-wrapper"><span>Prevent Upscaling</span><input id="noUpscale" type="checkbox"></label>
            <label class="checkbox-wrapper"><span>Auto-fit on Export</span><input id="fitExport" type="checkbox"></label>
          </div>
        </div>
      </div>

      <div class="sidebar-footer">
        <div class="stats">
          <span><strong id="showW">1000</strong> × <strong id="showH">1000</strong> px</span>
          <span id="sizeEstimate">Est: — KB</span>
        </div>
        <button id="exportBtn" class="btn btn-primary">Download Image</button>
      </div>
    </aside>
  </div>

<script>
/* ===== LOGIC ===== */
const canvas=document.getElementById('canvas'), ctx=canvas.getContext('2d',{alpha:true});
const fileInput=document.getElementById('file'), dropzone=document.getElementById('dropzone');
const welcomeState=document.getElementById('welcomeState'), editorState=document.getElementById('editorState');
const preset=document.getElementById('preset'), customSize=document.getElementById('customSize');
const outW=document.getElementById('outW'), outH=document.getElementById('outH');
const format=document.getElementById('format'), quality=document.getElementById('quality');
const qval=document.getElementById('qval'), qualityWrap=document.getElementById('qualityWrap');
const exportBtn=document.getElementById('exportBtn'), fitBtn=document.getElementById('fitBtn'), resetBtn=document.getElementById('resetBtn');
const noUpscale=document.getElementById('noUpscale'), fitExport=document.getElementById('fitExport');
const fname=document.getElementById('fname'), bgSelect=document.getElementById('bgSelect');
const sizeEstimate=document.getElementById('sizeEstimate'), overlayRange=document.getElementById('overlayRange');
const showW=document.getElementById('showW'), showH=document.getElementById('showH');

let img=new Image(), imgLoaded=false, initialScale=1;
let state={tx:0, ty:0, scale:1, imgW:0, imgH:0, minScale:0.001};

function toggleView(hasImage){
    if(hasImage){ welcomeState.classList.add('hidden'); editorState.classList.remove('hidden'); editorState.style.display='flex'; }
    else { welcomeState.classList.remove('hidden'); editorState.classList.add('hidden'); editorState.style.display='none'; }
}
function setVisualSize(w,h){
  const container=document.querySelector('.stage');
  const maxW=container.clientWidth-40, maxH=container.clientHeight-100; 
  const ratio=w/h; let visW=maxW, visH=maxW/ratio;
  if(visH>maxH){ visH=maxH; visW=maxH*ratio; }
  if(visW<200){ visW=200; visH=200/ratio; }
  canvas.width=visW; canvas.height=visH; render();
}
outW.value=1000; outH.value=1000; 
window.addEventListener('resize',()=>{ if(imgLoaded) setVisualSize(Number(outW.value), Number(outH.value)); });

preset.addEventListener('change',e=>{
  if(e.target.value==='custom'){ customSize.classList.remove('hidden'); }
  else { customSize.classList.add('hidden'); const [w,h]=e.target.value.split('x').map(Number); outW.value=w; outH.value=h; showW.textContent=w; showH.textContent=h; if(imgLoaded) setVisualSize(w,h); updateEstimate(); }
});
[outW, outH].forEach(el=>el.addEventListener('input',()=>{ 
    showW.textContent=outW.value; showH.textContent=outH.value; 
    if(imgLoaded) setVisualSize(Number(outW.value)||500, Number(outH.value)||500); updateEstimate(); 
}));

function loadFile(file){
  if(!file||!file.type.startsWith('image/')) return;
  const url=URL.createObjectURL(file); const im=new Image();
  im.onload=()=>{
    URL.revokeObjectURL(url); img=im; state.imgW=img.width; state.imgH=img.height;
    toggleView(true);
    setTimeout(()=>{
        const w=Number(outW.value), h=Number(outH.value); setVisualSize(w,h);
        initialScale=Math.max(canvas.width/state.imgW, canvas.height/state.imgH);
        state.scale=initialScale; state.tx=0; state.ty=0; imgLoaded=true; render(); updateEstimate();
    },50);
  };
  im.src=url;
}
dropzone.addEventListener('change',e=>{ if(e.target.files[0]) loadFile(e.target.files[0]); e.target.value=''; });
['dragenter','dragover','dragleave','drop'].forEach(ev=>window.addEventListener(ev,e=>e.preventDefault(),{passive:false}));
['dragenter','dragover'].forEach(ev=>dropzone.parentElement.addEventListener(ev,e=>{e.preventDefault(); dropzone.parentElement.style.borderColor='var(--primary)';}));
['dragleave','drop'].forEach(ev=>dropzone.parentElement.addEventListener(ev,e=>{e.preventDefault(); dropzone.parentElement.style.borderColor='var(--border)';}));
window.addEventListener('drop',e=>{e.preventDefault(); const f=e.dataTransfer.files&&e.dataTransfer.files[0]; if(f) loadFile(f);});
window.addEventListener('paste',e=>{ const items=e.clipboardData?.items; if(!items)return; for(const it of items){if(it.type.startsWith('image/')){loadFile(it.getAsFile());break;}} });

function render(){
  if(!imgLoaded)return; ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx=canvas.width/2, cy=canvas.height/2;
  ctx.save(); ctx.translate(cx+state.tx, cy+state.ty); ctx.scale(state.scale, state.scale); 
  ctx.drawImage(img, -state.imgW/2, -state.imgH/2, state.imgW, state.imgH); ctx.restore();
  const alpha=Number(overlayRange.value)||0; if(alpha>0){ctx.fillStyle=`rgba(0,0,0,${alpha})`; ctx.fillRect(0,0,canvas.width,canvas.height);}
}
let dragging=false, lastX=0, lastY=0;
canvas.addEventListener('mousedown',e=>{ dragging=true; lastX=e.clientX; lastY=e.clientY; });
window.addEventListener('mouseup',()=>{ dragging=false; });
window.addEventListener('mousemove',e=>{ if(!dragging||!imgLoaded)return; const dx=e.clientX-lastX, dy=e.clientY-lastY; lastX=e.clientX; lastY=e.clientY; state.tx+=dx; state.ty+=dy; render(); updateEstimate(); });
canvas.addEventListener('wheel',e=>{ if(!imgLoaded)return; e.preventDefault(); const delta=-e.deltaY, zoom=Math.exp(delta*0.0016); state.scale=Math.max(state.minScale, Math.min(500, state.scale*zoom)); render(); updateEstimate(); },{passive:false});
fitBtn.addEventListener('click',()=>{ if(!imgLoaded)return; const sx=canvas.width/state.imgW, sy=canvas.height/state.imgH; state.scale=Math.max(sx,sy); state.tx=0; state.ty=0; render(); });
resetBtn.addEventListener('click',()=>{ if(!imgLoaded)return; state.tx=0; state.ty=0; state.scale=initialScale; render(); });
quality.addEventListener('input',()=>{ qval.textContent=Number(quality.value).toFixed(2); updateEstimate(); });
format.addEventListener('change',()=>{ qualityWrap.classList.toggle('hidden',format.value==='image/png' || format.value==='image/svg+xml'); updateEstimate(); });
overlayRange.addEventListener('input',()=>render());

async function updateEstimate(){
  if(!imgLoaded){ sizeEstimate.textContent='Est: —'; return; }
  if(format.value === 'image/svg+xml') { sizeEstimate.textContent = 'Est: Vector/Wrap'; return; }
  
  const w=Number(outW.value)||1000, h=Number(outH.value)||1000;
  const oc=document.createElement('canvas'); oc.width=w; oc.height=h; const octx=oc.getContext('2d');
  const ratio=w/canvas.width;
  octx.translate(w/2+state.tx*ratio, h/2+state.ty*ratio); octx.scale(state.scale*ratio, state.scale*ratio); 
  octx.drawImage(img, -state.imgW/2, -state.imgH/2, state.imgW, state.imgH);
  const mime=format.value||'image/png';
  oc.toBlob(blob=>{ if(blob) sizeEstimate.textContent=`Est: ${Math.round(blob.size/1024)} KB`; }, mime, Number(quality.value));
}

exportBtn.addEventListener('click',async()=>{
  if(!imgLoaded)return alert('Please load an image first');
  let w=Number(outW.value)||1000, h=Number(outH.value)||1000;
  if(noUpscale.checked){ w=Math.min(w, state.imgW); h=Math.min(h, state.imgH); }
  const oc=document.createElement('canvas'); oc.width=w; oc.height=h; const octx=oc.getContext('2d',{alpha:true});
  const bg=bgSelect.value; if(bg!=='transparent'){ octx.fillStyle=bg; octx.fillRect(0,0,w,h); } else octx.clearRect(0,0,w,h);
  
  if(fitExport.checked){
    const s=Math.max(w/state.imgW, h/state.imgH); octx.translate(w/2, h/2); octx.scale(s,s); 
    octx.drawImage(img, -state.imgW/2, -state.imgH/2, state.imgW, state.imgH);
  } else {
    const ratio=w/canvas.width; octx.translate(w/2+state.tx*ratio, h/2+state.ty*ratio); 
    octx.scale(state.scale*ratio, state.scale*ratio); octx.drawImage(img, -state.imgW/2, -state.imgH/2, state.imgW, state.imgH);
  }

  const mime=format.value||'image/png';
  
  /* 1. SVG EXPORT LOGIC */
  if(mime === 'image/svg+xml'){
      const dataUrl = oc.toDataURL('image/png'); // embed as PNG
      const svgString = `<svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}"><image href="${dataUrl}" width="100%" height="100%" /></svg>`;
      const blob = new Blob([svgString], {type: 'image/svg+xml'});
      const link=document.createElement('a'); link.download=`${fname.value}.svg`; link.href=URL.createObjectURL(blob); link.click();
      return;
  }
  
  oc.toBlob(blob=>{ if(!blob)return; const link=document.createElement('a'); link.download=`${fname.value}.${mime.split('/')[1]}`; link.href=URL.createObjectURL(blob); link.click(); }, mime, Number(quality.value));
});
</script>
</body>
</html>