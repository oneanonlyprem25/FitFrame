<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>FitFrame Pro — Studio</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f1014;--panel:#18181b;--input:#27272a;
  --border:#3f3f46;--text:#f4f4f5;--muted:#a1a1aa;
  --pri:#6366f1;--pri-h:#4f46e5;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden}
.hidden{display:none!important}

.topbar{height:60px;background:var(--panel);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px}
.brand{font-family:Space Grotesk;font-size:22px;font-weight:700}

.workspace{display:flex;height:calc(100vh - 60px)}
.stage{flex:1;background:#09090b;display:flex;flex-direction:column;align-items:center;overflow:auto}

.gallery-wrapper{width:100%;background:#0003;border-bottom:1px solid var(--border);display:flex;align-items:center;padding:8px}
.gallery-bar{flex:1;display:flex;gap:10px;overflow-x:auto}
.thumb-wrap{position:relative}
.thumb{width:60px;height:60px;border-radius:8px;object-fit:cover;opacity:.6;cursor:pointer}
.thumb.active{opacity:1;border:2px solid var(--pri)}
.thumb-del{
  position:absolute;top:-6px;right:-6px;
  width:18px;height:18px;border:none;border-radius:50%;
  background:#ef4444;color:#fff;font-size:12px;
  cursor:pointer;line-height:18px
}

.canvas-container{margin:20px;border-radius:8px;overflow:hidden;border:1px solid #333;background:#121212}
canvas{display:block;max-width:100%;cursor:grab}

.sidebar{width:340px;background:var(--panel);border-left:1px solid var(--border);display:flex;flex-direction:column}
.sidebar-content{flex:1;overflow:auto;padding:20px;display:flex;flex-direction:column;gap:14px}
.sidebar-footer{padding:20px;border-top:1px solid var(--border)}

input,select{width:100%;background:var(--input);border:1px solid var(--border);color:#fff;padding:10px;border-radius:8px}
label{font-size:12px;color:var(--muted)}
.check-row{display:flex;justify-content:space-between;align-items:center;font-size:13px}
button{cursor:pointer}

.btn-primary{background:var(--pri);border:none;color:#fff;padding:14px;border-radius:8px;font-weight:600}
.btn-primary:hover{background:var(--pri-h)}
</style>
</head>

<body>

<header class="topbar">
  <div class="brand">FitFrame <span style="font-size:11px;color:#aaa">PRO</span></div>
  <div style="font-size:12px;color:#aaa">v4.7 Final</div>
</header>

<div class="workspace">

<main class="stage">

  <label id="dropzone" style="margin-top:60px;border:2px dashed #444;padding:40px;border-radius:16px;cursor:pointer">
    <input id="file" type="file" accept="image/*" multiple hidden>
    Upload Images
  </label>

  <div id="editor" class="hidden" style="width:100%">
    <div class="gallery-wrapper">
      <div id="galleryBar" class="gallery-bar"></div>
    </div>
    <div class="canvas-container">
      <canvas id="canvas"></canvas>
    </div>
  </div>

</main>

<aside class="sidebar">
<div class="sidebar-content">

<label>Width × Height</label>
<div style="display:flex;gap:8px">
  <input id="outW" type="number">
  <input id="outH" type="number">
</div>

<label>Content Fit</label>
<select id="contentFit">
  <option value="cover">Cover</option>
  <option value="contain">Contain</option>
</select>

<label>Background</label>
<select id="bgSelect">
  <option value="transparent">Transparent</option>
  <option value="#ffffff">White</option>
  <option value="#000000">Black</option>
</select>

<label class="check-row">
  <span>Auto Fill Background</span>
  <input id="autoBg" type="checkbox">
</label>

</div>

<div class="sidebar-footer">
<button id="exportBtn" class="btn-primary">Download</button>
</div>
</aside>

</div>

<script>
const canvas=document.getElementById('canvas'),ctx=canvas.getContext('2d',{alpha:true});
const fileIn=document.getElementById('file');
const galleryBar=document.getElementById('galleryBar');
const editor=document.getElementById('editor');
let queue=[],active=0,img=new Image(),loaded=false;

const state={w:1000,h:1000,fit:'cover',bg:'transparent',autoBg:false};

const saved=localStorage.getItem('fitframe:last');
if(saved)Object.assign(state,JSON.parse(saved));

outW.value=state.w;outH.value=state.h;
contentFit.value=state.fit;
bgSelect.value=state.bg;
autoBg.checked=state.autoBg;

function persist(){
  localStorage.setItem('fitframe:last',JSON.stringify(state));
}

[outW,outH,contentFit,bgSelect,autoBg].forEach(e=>e.onchange=()=>{
  state.w=+outW.value;state.h=+outH.value;
  state.fit=contentFit.value;
  state.bg=bgSelect.value;
  state.autoBg=autoBg.checked;
  persist();render();
});

fileIn.onchange=e=>{
  [...e.target.files].forEach(f=>{
    if(f.type.startsWith('image/'))
      queue.push({url:URL.createObjectURL(f),name:f.name});
  });
  if(queue.length){active=0;load();renderGallery();editor.classList.remove('hidden')}
};

dropzone.onclick=()=>fileIn.click();

function renderGallery(){
  galleryBar.innerHTML='';
  queue.forEach((it,i)=>{
    const w=document.createElement('div');w.className='thumb-wrap';
    const t=document.createElement('img');t.src=it.url;
    t.className='thumb'+(i===active?' active':'');
    t.onclick=()=>{active=i;load();renderGallery()};
    const d=document.createElement('button');d.textContent='×';d.className='thumb-del';
    d.onclick=e=>{
      e.stopPropagation();
      queue.splice(i,1);
      if(!queue.length){editor.classList.add('hidden');return}
      active=Math.max(0,i-1);load();renderGallery();
    };
    w.append(t,d);galleryBar.appendChild(w);
  });
}

function load(){
  img.onload=()=>{loaded=true;setCanvas();render()};
  img.src=queue[active].url;
}

function setCanvas(){
  const r=state.w/state.h;
  let w=Math.min(800,window.innerWidth-380);
  canvas.width=w;canvas.height=w/r;
}

function avgColor(){
  const c=document.createElement('canvas'),x=c.getContext('2d');
  c.width=c.height=10;x.drawImage(img,0,0,10,10);
  const d=x.getImageData(0,0,10,10).data;
  let r=0,g=0,b=0;
  for(let i=0;i<d.length;i+=4){r+=d[i];g+=d[i+1];b+=d[i+2]}
  return `rgb(${r/25|0},${g/25|0},${b/25|0})`;
}

function render(){
  if(!loaded)return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(state.bg!=='transparent'||state.autoBg){
    ctx.fillStyle=state.autoBg?avgColor():state.bg;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }
  let s=state.fit==='contain'
    ?Math.min(canvas.width/img.width,canvas.height/img.height)
    :Math.max(canvas.width/img.width,canvas.height/img.height);
  ctx.save();
  ctx.translate(canvas.width/2,canvas.height/2);
  ctx.scale(s,s);
  ctx.drawImage(img,-img.width/2,-img.height/2);
  ctx.restore();
}

exportBtn.onclick=()=>{
  const c=document.createElement('canvas');
  c.width=state.w;c.height=state.h;
  const x=c.getContext('2d');
  if(state.bg!=='transparent'||state.autoBg){
    x.fillStyle=state.autoBg?avgColor():state.bg;
    x.fillRect(0,0,c.width,c.height);
  }
  let s=state.fit==='contain'
    ?Math.min(c.width/img.width,c.height/img.height)
    :Math.max(c.width/img.width,c.height/img.height);
  x.translate(c.width/2,c.height/2);
  x.scale(s,s);
  x.drawImage(img,-img.width/2,-img.height/2);
  c.toBlob(b=>{
    const a=document.createElement('a');
    a.href=URL.createObjectURL(b);
    a.download='export.png';a.click();
  });
};
</script>

</body>
</html>
